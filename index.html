<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>都享券 - 粵港澳大灣區消費出行一券通</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            /* 戰略合作主題 - 深邃藍紫 */
            --bg-dark: #0b1121;       
            --sidebar-bg: #111827;    
            --card-bg: rgba(30, 41, 59, 0.8); 
            --border-color: #374151;
            --text-primary: #f3f4f6;
            --text-secondary: #9ca3af;
            
            --accent-blue: #3b82f6;   /* 卓啟科技藍 */
            --accent-purple: #8b5cf6; /* 蟻米戰略紫 */
            --accent-green: #10b981;  /* 資金/核銷 */
            --accent-gold: #f59e0b;   /* VIP/權益 */
            --accent-red: #ef4444;    /* 風控 */
        }

        body { 
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif; 
            background-color: var(--bg-dark); 
            color: var(--text-primary);
            height: 100vh; 
            overflow: hidden; 
            display: flex;
        }

        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }

        /* ================= 登入畫面 ================= */
        #login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #1f2937 0%, #030712 100%);
            z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column;
            transition: opacity 0.5s ease;
        }
        .login-card-container { display: flex; gap: 40px; margin-top: 50px; }
        .login-option-card {
            width: 340px; background: rgba(31, 41, 55, 0.6); border: 1px solid var(--border-color);
            border-radius: 24px; padding: 40px 30px; text-align: center; cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); backdrop-filter: blur(20px);
            position: relative; overflow: hidden;
        }
        .login-option-card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple)); opacity: 0; transition: 0.3s;
        }
        .login-option-card:hover { transform: translateY(-8px); background: rgba(59, 130, 246, 0.1); border-color: var(--accent-blue); box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .login-option-card:hover::before { opacity: 1; }
        
        .login-icon { font-size: 3.5rem; margin-bottom: 25px; color: var(--text-secondary); transition: 0.3s; }
        .login-option-card:hover .login-icon { color: var(--accent-blue); transform: scale(1.1); }
        
        /* 聯合品牌標識 */
        .co-brand-footer {
            margin-top: 60px; text-align: center; font-size: 0.8rem; color: var(--text-secondary);
            opacity: 0.7; letter-spacing: 0.5px;
        }
        .co-brand-logo { display: inline-flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .co-brand-logo i { font-size: 1.2rem; }

        /* ================= 主應用 ================= */
        #app-container { display: none; width: 100%; height: 100%; display: flex; opacity: 0; transition: opacity 0.5s ease; }

        .sidebar { width: 280px; background-color: var(--sidebar-bg); border-right: 1px solid var(--border-color); display: flex; flex-direction: column; padding: 1.5rem; z-index: 1000; box-shadow: 5px 0 30px rgba(0,0,0,0.3); }
        .app-brand { font-size: 1.2rem; font-weight: 700; margin-bottom: 2.5rem; color: #fff; display: flex; align-items: center; gap: 10px; }
        
        .nav-item { padding: 12px 15px; margin-bottom: 8px; border-radius: 12px; cursor: pointer; color: var(--text-secondary); transition: all 0.2s; display: flex; align-items: center; font-weight: 500; }
        .nav-item:hover { background: rgba(255,255,255,0.05); color: #fff; }
        .nav-item.active { background: linear-gradient(90deg, rgba(59, 130, 246, 0.15), transparent); color: #fff; border-left: 3px solid var(--accent-blue); }
        .nav-item i { width: 30px; text-align: center; margin-right: 8px; font-size: 1.1rem; }
        
        .nav-item-secret { margin-top: 20px; color: var(--accent-purple); border: 1px dashed rgba(139, 92, 246, 0.3); }
        .nav-item-secret:hover { background: rgba(139, 92, 246, 0.1); color: #fff; border-color: var(--accent-purple); }

        .main-content { flex-grow: 1; padding: 25px; display: flex; flex-direction: column; position: relative; background: radial-gradient(circle at top right, #1f2937 0%, #030712 60%); }
        
        /* 頂部狀態欄 */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; height: 40px; }
        .tech-badges { display: flex; gap: 10px; }
        .tech-badge { font-size: 0.75rem; padding: 4px 12px; border-radius: 20px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-color); display: flex; align-items: center; gap: 6px; color: var(--text-secondary); }
        .tech-badge.active { border-color: var(--accent-green); color: var(--accent-green); box-shadow: 0 0 10px rgba(16, 185, 129, 0.1); }

        /* 儀表板通用 */
        .kpi-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 20px; height: 120px; }
        .kpi-card { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 16px; padding: 20px; display: flex; flex-direction: column; justify-content: center; backdrop-filter: blur(10px); position: relative; overflow: hidden; }
        .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: var(--accent-color); }
        
        .dashboard-grid { display: grid; grid-template-columns: 2fr 1fr; grid-template-rows: minmax(0, 1fr) 240px; gap: 20px; flex-grow: 1; min-height: 0; }
        .panel { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 16px; display: flex; flex-direction: column; overflow: hidden; backdrop-filter: blur(10px); }
        .panel-head { padding: 15px 20px; border-bottom: 1px solid var(--border-color); font-weight: 600; display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.02); }
        .panel-body { flex-grow: 1; position: relative; padding: 0; overflow: hidden; }

        /* ================= 秘密模態框 ================= */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(5px);
            z-index: 2000; display: none; justify-content: center; align-items: center;
        }
        .secret-modal {
            width: 500px; background: #1f2937; border: 1px solid var(--accent-purple);
            border-radius: 20px; padding: 30px; text-align: center;
            box-shadow: 0 0 50px rgba(139, 92, 246, 0.2);
            transform: scale(0.9); transition: 0.3s;
        }
        .secret-content { display: none; text-align: left; max-height: 70vh; overflow-y: auto; }
        
        /* ================= SVG 地圖增強 ================= */
        #map-container { width: 100%; height: 100%; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; background: radial-gradient(circle at center, #111827 0%, #020617 100%); }
        .svg-map { width: 100%; height: 100%; transition: transform 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        #gba-svg, #huangpu-svg { display: none; }
        .active-map { display: block !important; }

        .map-land { fill: #1e293b; stroke: #3b82f6; stroke-width: 0.8; transition: all 0.3s; }
        .map-land:hover { fill: #263c59; stroke: #60a5fa; }
        .map-land-mo { fill: #1e293b; stroke: #f59e0b; stroke-width: 1; } /* 澳門專屬色 */
        
        .live-pulse { position: absolute; transform: translate(-50%, -50%); pointer-events: none; z-index: 20; }
        .live-pulse .core { width: 6px; height: 6px; background: #fff; border-radius: 50%; position: absolute; top:50%; left:50%; transform:translate(-50%,-50%); }
        .live-pulse .ripple { position: absolute; top:50%; left:50%; transform:translate(-50%,-50%); border: 2px solid var(--c); border-radius: 50%; animation: ripple 1.5s ease-out forwards; }
        @keyframes ripple { 0% { width:0; height:0; opacity:1; } 100% { width:80px; height:80px; opacity:0; } }

        /* 表格與列表 */
        .table-dark-custom { width: 100%; margin: 0; font-size: 0.85rem; color: var(--text-secondary); }
        .table-dark-custom th { padding: 12px; border-bottom: 1px solid var(--border-color); text-align: left; }
        .table-dark-custom td { padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); color: var(--text-primary); }
        
        .feed-item { display: flex; justify-content: space-between; padding: 10px 15px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 0.85rem; animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* 隱藏/顯示 */
        .view-section { display: none; height: 100%; flex-direction: column; }
        .view-section.active { display: flex; }
    </style>
</head>
<body>

<!-- 1. 登入引導頁 -->
<div id="login-screen">
    <div class="text-center mb-5">
        <h1 class="display-3 fw-bold text-white mb-2"><i class="fas fa-ticket-alt text-primary me-3"></i>都享券</h1>
        <p class="text-secondary fs-5">大灣區消費出行一券通 · 數字化運營中樞</p>
    </div>

    <div class="login-card-container">
        <!-- 模式 A -->
        <div class="login-option-card" onclick="startApp('huangpu')">
            <div class="login-icon"><i class="fas fa-map-location-dot"></i></div>
            <h4 class="text-white fw-bold mb-3">廣州市黃埔區示範</h4>
            <div class="text-secondary small">
                區域運營模式 (Regional)<br>
                覆蓋科學城、大沙地商圈<br>
                <span class="text-primary">高頻餐飲與文旅核銷</span>
            </div>
        </div>

        <!-- 模式 B -->
        <div class="login-option-card" onclick="startApp('gba')">
            <div class="login-icon"><i class="fas fa-globe-asia"></i></div>
            <h4 class="text-white fw-bold mb-3">粵港澳擴展示範</h4>
            <div class="text-secondary small">
                戰略總部模式 (Strategic)<br>
                覆蓋廣州、香港、澳門<br>
                <span class="text-purple">跨境支付與多幣種清算</span>
            </div>
        </div>
    </div>
    
    <div class="co-brand-footer">
        <div class="co-brand-logo">
            <i class="fas fa-cubes text-primary"></i> <span>廣東卓啟雲鏈</span>
            <span class="mx-2">×</span>
            <i class="fas fa-network-wired text-purple"></i> <span>香港蟻米集團</span>
        </div>
        <div>@2025 廣東卓啟雲鏈科技有限公司， 香港蟻米集團國際有限公司</div>
        <div class="mt-1 small text-muted">Powered by YIMI Blockchain & YIMI AI</div>
    </div>
</div>

<!-- 2. 主應用界面 -->
<div id="app-container">
    <!-- 左側導航 -->
    <div class="sidebar">
        <div class="app-brand">
            <i class="fas fa-cubes text-primary me-2"></i> 卓啟雲鏈 · 都享券
        </div>
        
        <div class="nav-item active" onclick="switchView('ops')"><i class="fas fa-chart-pie"></i> 運營駕駛艙</div>
        <div class="nav-item" onclick="switchView('fin')"><i class="fas fa-coins"></i> 資金與營收</div>
        <div class="nav-item" onclick="switchView('app')"><i class="fas fa-mobile-screen"></i> 用戶端體驗</div>
        <div class="nav-item" id="nav-item-gba" onclick="switchView('gba')"><i class="fas fa-bridge"></i> 粵港澳拓展</div>
        
        <!-- 秘密通道 -->
        <div class="nav-item nav-item-secret" onclick="openSecretModal()">
            <i class="fas fa-handshake"></i> 戰略合作夥伴
        </div>

        <div class="mt-auto">
            <div class="nav-item text-danger border border-danger border-opacity-25 justify-content-center mt-3" onclick="goHome()">
                <i class="fas fa-power-off me-2"></i> 退出系統
            </div>
            <div class="mt-4 pt-3 border-top border-secondary border-opacity-25 text-center">
                <div class="small text-muted mb-1">技術支持</div>
                <div class="small text-white opacity-75">YIMI Blockchain & AI</div>
                <div class="small text-secondary mt-1" style="font-size: 0.65rem;">@2025 卓啟雲鏈 x 蟻米集團</div>
            </div>
        </div>
    </div>

    <!-- 右側內容 -->
    <div class="main-content">
        <!-- 頂部 -->
        <div class="header">
            <h5 class="m-0 fw-bold text-white" id="page-title">加載中...</h5>
            <div class="d-flex align-items-center gap-4">
                <div class="tech-badges">
                    <div class="tech-badge active"><i class="fas fa-link"></i> 蟻米鏈節點正常</div>
                    <div class="tech-badge active"><i class="fas fa-robot"></i> DeepSeek AI 運算中</div>
                </div>
                <div class="text-secondary small d-flex align-items-center gap-2">
                    <div class="status-dot"></div> <span id="clock">00:00:00</span>
                </div>
            </div>
        </div>

        <!-- 視圖 1: 運營監控 -->
        <div id="view-ops" class="view-section active">
            <div class="kpi-row">
                <div class="kpi-card" style="--accent-color: var(--accent-blue)">
                    <div class="kpi-label" id="lbl-merchant">合作商家</div>
                    <div class="kpi-value" id="val-merchants">2,150</div>
                    <div class="kpi-sub"><span id="sub-merchant">核心商圈覆蓋率 85%</span> <span class="trend-up">+5.2%</span></div>
                </div>
                <div class="kpi-card" style="--accent-color: var(--accent-green)">
                    <div class="kpi-label">今日核銷流水 (CNY)</div>
                    <div class="kpi-value text-success" id="val-gmv">1,452,000</div>
                    <div class="kpi-sub"><span>日環比 +12.5%</span> <span class="trend-up"><i class="fas fa-bolt"></i> Live</span></div>
                </div>
                <div class="kpi-card" style="--accent-color: var(--accent-gold)">
                    <div class="kpi-label">都享匯活躍用戶</div>
                    <div class="kpi-value text-warning">158,400</div>
                    <div class="kpi-sub"><span>打卡轉化率 32%</span></div>
                </div>
                <div class="kpi-card" style="--accent-color: var(--accent-red)">
                    <div class="kpi-label">風控預警</div>
                    <div class="kpi-value text-danger">3 <small class="fs-6">家</small></div>
                    <div class="kpi-sub"><span>需人工介入</span></div>
                </div>
            </div>

            <div class="dashboard-grid">
                <!-- 地圖 -->
                <div class="panel" style="grid-row: 1 / span 2; grid-column: 1;">
                    <div class="panel-head">
                        <span><i class="fas fa-map-marked-alt text-primary me-2"></i>實時交易熱力分佈</span>
                        <div class="btn-group btn-group-sm" id="map-controls"></div>
                    </div>
                    <div class="panel-body">
                        <div id="map-container">
                            <svg style="position: absolute; width:100%; height:100%; pointer-events: none; opacity: 0.1;">
                                <defs><pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse"><path d="M 40 0 L 0 0 0 40" fill="none" stroke="#fff" stroke-width="0.5"/></pattern></defs>
                                <rect width="100%" height="100%" fill="url(#grid)" />
                            </svg>

                            <!-- 地圖A: 大灣區 (含澳門地標) -->
                            <svg class="svg-map" id="gba-svg" viewBox="0 0 800 600" preserveAspectRatio="xMidYMid slice">
                                <!-- 大陸 -->
                                <path id="region-mainland" class="map-land" d="M0,0 L800,0 L800,250 L750,260 L700,240 L650,280 L600,350 L500,320 L480,280 L450,250 L400,280 L350,250 L300,300 L250,350 L200,320 L100,350 L0,300 Z" />
                                <!-- 珠海/澳門區域 -->
                                <path id="region-zh-mo" class="map-land-mo" d="M250,380 L320,380 L350,420 L340,480 L300,520 L280,550 L200,500 L150,450 Z" />
                                <!-- 香港 -->
                                <path id="region-hk" class="map-land" d="M620,380 L720,360 L780,400 L750,480 L680,500 L640,450 Z" />
                                
                                <!-- 連接線 -->
                                <line x1="450" y1="280" x2="680" y2="420" stroke="#3b82f6" stroke-width="1" stroke-dasharray="5,5" opacity="0.6"/>
                                <line x1="450" y1="280" x2="300" y2="480" stroke="#f59e0b" stroke-width="1" stroke-dasharray="5,5" opacity="0.6"/>
                                
                                <!-- 地標點 -->
                                <circle cx="450" cy="280" r="4" fill="#fff" /> <text x="460" y="275" fill="#fff" font-size="10">廣州總部</text>
                                <circle cx="680" cy="420" r="4" fill="#fff" /> <text x="690" y="415" fill="#fff" font-size="10">香港</text>
                                <!-- 澳門地標 -->
                                <circle cx="300" cy="480" r="4" fill="#f59e0b" /> 
                                <text x="290" y="470" fill="#f59e0b" font-size="10" text-anchor="end">澳門·大三巴</text>
                                <text x="290" y="500" fill="#f59e0b" font-size="10" text-anchor="end">威尼斯人</text>
                            </svg>

                            <!-- 地圖B: 黃埔區 -->
                            <svg class="svg-map" id="huangpu-svg" viewBox="0 0 800 600" preserveAspectRatio="xMidYMid slice">
                                <path class="map-land" d="M250,150 L550,120 L650,250 L600,350 L200,300 Z" fill="#1e293b" />
                                <path class="map-land" d="M220,320 L580,360 L620,450 L300,480 Z" fill="#1e293b" />
                                <path class="map-land" d="M350,500 L500,490 L550,550 L380,580 Z" fill="#1e293b" stroke="#10b981" />
                                <text x="400" y="220" fill="#10b981" font-size="14" text-anchor="middle" opacity="0.8">科學城</text>
                                <text x="450" y="530" fill="#f59e0b" font-size="14" text-anchor="middle" opacity="0.8">長洲島文旅</text>
                            </svg>

                            <div id="map-overlay" style="position: absolute; top:0; left:0; width:100%; height:100%; pointer-events: none;"></div>
                        </div>
                    </div>
                </div>

                <!-- 交易日誌 -->
                <div class="panel" style="grid-row: 1; grid-column: 2;">
                    <div class="panel-head"><span><i class="fas fa-list text-warning me-2"></i>最新區塊鏈交易</span></div>
                    <div class="panel-body" style="overflow-y: auto;">
                        <div id="feed-list" class="p-0"></div>
                    </div>
                </div>

                <!-- 風控 -->
                <div class="panel" style="grid-row: 2; grid-column: 2;">
                    <div class="panel-head"><span><i class="fas fa-shield-halved text-danger me-2"></i>異常監控</span></div>
                    <div class="panel-body p-3">
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <span class="text-white">黃埔人家(大沙地)</span> <span class="badge bg-warning">核銷率異常</span>
                        </div>
                        <div class="d-flex align-items-center justify-content-between">
                            <span class="text-white">特色私廚(科學城)</span> <span class="badge bg-danger">經營凍結</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 視圖 2, 3, 4 (簡化結構，保留原邏輯) -->
        <div id="view-fin" class="view-section">
            <!-- 財務內容 (同上版) -->
            <div class="panel h-100 d-flex justify-content-center align-items-center">
                <h3 class="text-secondary">財務與營收模型 (已加載 10 億投資計劃)</h3>
            </div>
        </div>
        <div id="view-app" class="view-section">
            <div class="panel h-100 d-flex justify-content-center align-items-center">
                <h3 class="text-secondary">用戶端雙機演示 (準備就緒)</h3>
            </div>
        </div>
        <div id="view-gba" class="view-section">
            <div class="panel h-100 d-flex justify-content-center align-items-center">
                <h3 class="text-secondary">粵港澳擴展路線圖 (Phase 1-3)</h3>
            </div>
        </div>

    </div>
</div>

<!-- 3. 秘密模態框 -->
<div class="modal-overlay" id="secret-modal">
    <div class="secret-modal">
        <div id="secret-lock">
            <i class="fas fa-lock fa-3x text-secondary mb-3"></i>
            <h4 class="text-white mb-3">請輸入訪問密碼</h4>
            <input type="password" id="secret-input" class="form-control text-center mb-3 bg-dark text-white border-secondary" placeholder="****" maxlength="4">
            <button class="btn btn-primary w-100" onclick="checkSecret()">解鎖文檔</button>
            <button class="btn btn-link text-secondary mt-2" onclick="closeSecretModal()">取消</button>
        </div>
        
        <div id="secret-content" class="secret-content">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="text-warning m-0"><i class="fas fa-file-contract me-2"></i>戰略合作框架協議</h5>
                <button class="btn btn-sm btn-outline-secondary" onclick="closeSecretModal()">關閉</button>
            </div>
            <div class="p-3 bg-dark rounded border border-secondary text-secondary small">
                <p><strong>甲方：</strong>廣東卓啟雲鏈科技有限公司 (張錦喜)</p>
                <p><strong>乙方：</strong>蟻米集團(國際)有限公司 (林毅)</p>
                <hr class="border-secondary">
                <p><strong>合作目標：</strong></p>
                <ul>
                    <li>雙方在廣州設立合資公司，構建大灣區惠民出行消費平台。</li>
                    <li>推動「都享券」從廣州向珠三角及香港擴張。</li>
                    <li>基於甲方區塊鏈技術(無幣)打造商業流量變現生態。</li>
                </ul>
                <p><strong>權利義務：</strong></p>
                <ul>
                    <li>甲方：負責平台搭建、系統開發及技術維護，確保數據安全。</li>
                    <li>乙方：負責引入資金，推動香港運營，組織商家大會及營銷推廣。</li>
                </ul>
                <p><strong>合作期限：</strong>10年 (2025年11月簽署)</p>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    let currentMode = 'gba';
    let feedInterval;

    // --- 啟動 ---
    function startApp(mode) {
        currentMode = mode;
        document.getElementById('login-screen').style.opacity = '0';
        setTimeout(() => {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app-container').style.display = 'flex';
            setTimeout(() => { document.getElementById('app-container').style.opacity = '1'; }, 10);
            initSystem(mode);
            updateTime();
            startLiveFeed();
            
            // 地圖切換
            document.querySelectorAll('.svg-map').forEach(el => el.classList.remove('active-map'));
            if(mode === 'huangpu') {
                document.getElementById('huangpu-svg').classList.add('active-map');
            } else {
                document.getElementById('gba-svg').classList.add('active-map');
            }
        }, 500);
    }

    function goHome() {
        clearInterval(feedInterval);
        document.getElementById('app-container').style.opacity = '0';
        setTimeout(() => {
            document.getElementById('app-container').style.display = 'none';
            document.getElementById('login-screen').style.display = 'flex';
            setTimeout(() => { document.getElementById('login-screen').style.opacity = '1'; }, 10);
            switchView('ops');
        }, 500);
    }

    function initSystem(mode) {
        const title = document.getElementById('page-title');
        const env = document.getElementById('env-label');
        const navGba = document.getElementById('nav-item-gba');
        const mapBtns = document.getElementById('map-controls');

        if(mode === 'huangpu') {
            title.innerText = "廣州市黃埔區數字化運營中心";
            env.innerText = "環境: 黃埔本地節點";
            navGba.style.display = 'none';
            mapBtns.innerHTML = `<button class="btn btn-outline-secondary btn-sm active">科學城</button><button class="btn btn-outline-secondary btn-sm">長洲島</button>`;
            document.getElementById('lbl-merchant').innerText = "黃埔入駐商家";
        } else {
            title.innerText = "粵港澳大灣區數字化運營駕駛艙";
            env.innerText = "環境: 大灣區核心節點";
            navGba.style.display = 'flex';
            mapBtns.innerHTML = `<button class="btn btn-outline-secondary btn-sm active">全覽</button><button class="btn btn-outline-secondary btn-sm">香港</button><button class="btn btn-outline-secondary btn-sm">澳門</button>`;
            document.getElementById('lbl-merchant').innerText = "大灣區合作商家";
        }
    }

    function switchView(id) {
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        document.getElementById('view-' + id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        const nav = document.querySelector(`.nav-item[onclick*="'${id}'"]`);
        if(nav) nav.classList.add('active');
    }

    // --- 秘密模態框邏輯 ---
    function openSecretModal() {
        document.getElementById('secret-modal').style.display = 'flex';
        document.getElementById('secret-lock').style.display = 'block';
        document.getElementById('secret-content').style.display = 'none';
        document.getElementById('secret-input').value = '';
    }
    function closeSecretModal() {
        document.getElementById('secret-modal').style.display = 'none';
    }
    function checkSecret() {
        const val = document.getElementById('secret-input').value;
        if(val === '8888') {
            document.getElementById('secret-lock').style.display = 'none';
            document.getElementById('secret-content').style.display = 'block';
        } else {
            alert('密碼錯誤！');
        }
    }

    // --- 實時熱點與日誌 ---
    // 擴充 Sample 數據庫
    const hpLocs = [
        "黃埔·科學城萬達", "黃埔·大沙地東", "黃埔·長洲島農莊", "黃埔·魚珠碼頭", 
        "黃埔·蘿崗奧園", "黃埔·南海神廟", "黃埔·至泰廣場"
    ];
    const gbaLocs = [
        "廣州·天河城", "廣州·北京路", "香港·銅鑼灣", "香港·尖沙咀", 
        "澳門·大三巴", "澳門·威尼斯人", "澳門·官也街", "珠海·拱北口岸"
    ];
    // 座標範圍
    const geo = {
        huangpu: { x: [350, 450], y: [200, 300], c: '#10b981' },
        gba_gz: { x: [400, 500], y: [250, 350], c: '#3b82f6' },
        gba_hk: { x: [640, 720], y: [380, 460], c: '#8b5cf6' },
        gba_mo: { x: [280, 320], y: [460, 500], c: '#f59e0b' } // 澳門黃色
    };

    function spawnPulse(type) {
        const container = document.getElementById('map-overlay');
        let range;
        
        if (currentMode === 'huangpu') {
            range = geo.huangpu;
        } else {
            // 根據類型分配顏色區域
            if (type.includes('澳門')) range = geo.gba_mo;
            else if (type.includes('香港')) range = geo.gba_hk;
            else range = geo.gba_gz;
        }
        
        const x = range.x[0] + Math.random() * (range.x[1] - range.x[0]);
        const y = range.y[0] + Math.random() * (range.y[1] - range.y[0]);
        
        const pulse = document.createElement('div');
        pulse.className = 'live-pulse';
        pulse.style.left = (x/800*100) + '%';
        pulse.style.top = (y/600*100) + '%';
        pulse.style.setProperty('--c', range.c);
        pulse.innerHTML = `<div class="core"></div><div class="ripple"></div>`;
        container.appendChild(pulse);
        setTimeout(() => pulse.remove(), 2000);
    }

    function startLiveFeed() {
        if(feedInterval) clearInterval(feedInterval);
        const list = document.getElementById('feed-list');
        const dashGmv = document.getElementById('val-gmv');
        let total = 1452000;

        feedInterval = setInterval(() => {
            let pool = currentMode === 'huangpu' ? hpLocs : gbaLocs;
            const target = pool[Math.floor(Math.random() * pool.length)];
            const act = Math.random() > 0.3 ? "核銷" : "充值";
            const amt = Math.floor(Math.random() * 800) + 50;
            const time = new Date().toLocaleTimeString();

            // 生成日誌
            const row = document.createElement('div');
            row.className = "feed-item";
            let colorClass = act === '核銷' ? 'text-warning' : 'text-success';
            if (target.includes('澳門')) colorClass = 'text-warning'; // 澳門特別標示
            
            row.innerHTML = `<span class="text-secondary">${time} ${target}</span><span class="${colorClass}">${act} ¥${amt}</span>`;
            list.prepend(row);
            if(list.children.length > 8) list.lastElementChild.remove();

            if (act === "核銷") {
                total += amt;
                dashGmv.innerText = total.toLocaleString();
            }

            // 觸發熱點
            spawnPulse(target);

        }, 600); // 高頻刷新
    }

    function updateTime() { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); setTimeout(updateTime, 1000); }
</script>
</body>
</html>
